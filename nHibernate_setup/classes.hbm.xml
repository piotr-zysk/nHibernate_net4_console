<?xml version="1.0" encoding="utf-8" ?>
<hibernate-mapping xmlns="urn:nhibernate-mapping-2.2"
namespace="nHibernate.entities" assembly="nHibernate.entities">

  <class name="User" table="Users">

    <id name="Id">
      <column name="Id" sql-type="int" not-null="true"/>
      <generator class="native" />
    </id>

    <property name="FirstName">
      <column name="FirstName" length="20" not-null="true" />
    </property>

    <property name="LastName">
      <column name="LastName" length="20" not-null="true" />
    </property>

    <set
      name="Messages"
      inverse="true"
      lazy="true"
      cascade="all">

      <key column="UserId"/>
      <one-to-many class="MessageRecipient"/>
    </set>

    <set
      name="SentMessages"
      inverse="true"
      lazy="true"
      cascade="all">

      <key column="AuthorId"/>
      <one-to-many class="Message"/>
    </set>
    
  </class>
    
 

  <class name="Message" table="Messages">

    <id name="Id">
      <column name="Id" sql-type="int" not-null="true"/>
      <generator class="native" />
    </id>

    <property name="Title">
      <column name="Title" length="50" not-null="true" />
    </property>

    <property name="Content">
      <column name="Content" length="20" not-null="true" />
    </property>

    <property name="Priority">
      <column name="Priority" not-null="true" />
    </property>

    <many-to-one
      name="Author"
      class="User"
      column="AuthorId"
      not-null="false"/>


    <set name="Recipients"
      inverse="true"
      lazy="true"
      cascade="all">
      <key column="MessageId"/>
      <one-to-many class="MessageRecipient"/>
    </set>

  </class>

  
  <class name="MessageRecipient" table="MessageRecipients">
    <id name="Id">
      <generator class="native"/>
    </id>

    <many-to-one
      name="User"
      column="UserId"
      not-null="false"/>

    <many-to-one
      name="Message"
      column="MessageId"
      not-null="true"/>


    <property name="Status">
      <column name="Status" not-null="true" />
    </property>    
    
  </class>
  
  

</hibernate-mapping>